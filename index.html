<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EDI Order File Generator — Bloomsbury</title>

  <!-- SheetJS: Excel/CSV parsing library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <!-- JSZip: ZIP file creation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <!-- Font Awesome: icon library -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <!-- Google Fonts: IBM Plex Sans (UI) + IBM Plex Mono (code/fields) -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:wght@300;400;600&display=swap">

  <!-- Application styles -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- ═══════════════════════════════════════════════
       HEADER — branding bar
  ═══════════════════════════════════════════════ -->
  <header>
    <div class="logo">
      <div class="logo-icon">
        <i class="fa-solid fa-file-lines"></i>
      </div>
      <div>
        <h1>EDI Order File Generator</h1>
        <p>Bloomsbury Publishing — Fixed-Width EDI File Converter</p>
      </div>
    </div>
  </header>

  <!-- ═══════════════════════════════════════════════
       MAIN LAYOUT — sidebar + content area
  ═══════════════════════════════════════════════ -->
  <main>

    <!-- ─────────────────────────────────────────
         SIDEBAR — controls and settings
    ───────────────────────────────────────── -->
    <aside class="sidebar">

      <!-- Panel: File upload + Generate trigger -->
      <div class="panel">
        <div class="panel-title">Import Excel Data</div>

        <!-- Drag-and-drop / click-to-browse upload zone -->
        <div class="dropzone" id="dropzone">
          <input type="file" id="fileInput" accept=".xlsx,.xls,.csv">
          <div class="dropzone-icon">
            <i class="fa-solid fa-file-excel"></i>
          </div>
          <p>Drop your <strong>Order Excel file</strong> here<br>or click to browse</p>
        </div>

        <!-- Upload status message (success / error) injected here by JS -->
        <div id="uploadMsg"></div>

        <!-- Generate button — sits directly below the dropzone -->
        <button class="btn btn-primary" style="width:100%;margin-top:14px" onclick="generateEDI()">
          <i class="fa-solid fa-bolt"></i> Generate EDI File
        </button>
      </div>

      <!-- Panel: EDI file configuration settings (collapsible, closed by default) -->
      <div class="panel">
        <div class="panel-title collapsible" id="settingsToggle" onclick="toggleSettings()">
          File Settings
          <i class="fa-solid fa-chevron-down toggle-icon"></i>
        </div>
        <div class="collapsible-body" id="settingsBody">

          <div class="field-row">
            <div class="field-group">
              <label>File ID / Batch Number</label>
              <input type="text" id="fileId" value="0027816" maxlength="10" placeholder="0027816">
            </div>
            <div class="field-group">
              <label>File Prefix</label>
              <input type="text" id="filePrefix" value="PO" readonly class="input-readonly">
            </div>
          </div>

          <div class="field-row">
            <div class="field-group">
              <label>Sender Code</label>
              <input type="text" id="senderCode" value="BLOO" readonly class="input-readonly">
            </div>
            <div class="field-group">
              <label>Currency</label>
              <input type="text" id="currency" value="GBP" maxlength="3">
            </div>
          </div>

          <div class="field-group">
            <label>Payment Terms</label>
            <select id="payTerms">
              <option value="FCA">FCA — Free Carrier</option>
              <option value="DAP">DAP — Delivered at Place</option>
            </select>
          </div>

          <div class="field-row">
            <!-- Order number seed: auto-generated at runtime, read-only display -->
            <div class="field-group" style="grid-column: 1 / -1;">
              <label>
                Order Number Start
                <span class="auto-label">
                  <i class="fa-solid fa-clock"></i> auto-generated at runtime
                </span>
              </label>
              <input type="text" id="orderNumStart" value="" readonly class="input-readonly">
              <div class="field-hint">
                Format: <span class="mono-hint">3 + YYMMDDHHММ</span> — unique per minute, regenerated on each Generate click
              </div>
            </div>
            <div class="field-group">
              <label>Default Qty</label>
              <input type="number" id="defaultQty" value="1" min="1" max="9999">
            </div>
          </div>

        </div>
      </div>

      <!-- Panel: Column mapping (collapsible, closed by default) -->
      <div class="panel" id="mappingPanel" style="display:none">
        <div class="panel-title collapsible" id="mappingToggle" onclick="toggleMapping()">
          Column Mapping
          <i class="fa-solid fa-chevron-down toggle-icon"></i>
        </div>
        <div class="collapsible-body" id="mappingBody">
          <div class="mapping-grid" id="mappingGrid"></div>
        </div>
      </div>

      <!-- Panel: XML Metadata Generator -->
      <div class="panel">
        <div class="panel-title">Generate XML Metadata</div>

        <div class="dropzone" id="xmlDropzone">
          <input type="file" id="xmlFileInput" accept=".xlsx,.xls,.csv">
          <div class="dropzone-icon">
            <i class="fa-solid fa-file-code"></i>
          </div>
          <p>Drop your <strong>Metadata Excel file</strong> here<br>or click to browse</p>
        </div>

        <div id="xmlUploadMsg"></div>

        <button class="btn btn-xml" style="width:100%;margin-top:14px" onclick="generateXMLMetadata()">
          <i class="fa-solid fa-code"></i> Generate XML &amp; Download ZIP
        </button>
      </div>

    </aside>

    <!-- ─────────────────────────────────────────
         CONTENT AREA — data preview + EDI output
    ───────────────────────────────────────── -->
    <div class="content-area">

      <!-- Tab bar + action buttons -->
      <div class="content-header">
        <button class="tab-btn active" onclick="switchTab('data', this)">
          <i class="fa-solid fa-table"></i> Source Data
        </button>
        <button class="tab-btn" onclick="switchTab('preview', this)">
          <i class="fa-solid fa-eye"></i> EDI Preview
        </button>
        <div class="btn-actions">
          <button class="btn btn-secondary" onclick="clearData()" id="clearBtn" style="display:none">
            <i class="fa-solid fa-trash-can"></i> Clear Data
          </button>
          <button class="btn btn-success" onclick="downloadFile()" id="downloadBtn" style="display:none">
            <i class="fa-solid fa-download"></i> Download File
          </button>
        </div>
      </div>

      <!-- Stats bar (shown after file load) -->
      <div class="stats-row" id="statsRow" style="display:none">
        <div class="stat">
          <span class="stat-val" id="statRows">0</span>
          <span class="stat-lbl">rows</span>
        </div>
        <div class="stat">
          <span class="stat-val" id="statOrders">0</span>
          <span class="stat-lbl">orders</span>
        </div>
        <div class="stat">
          <span class="stat-val" id="statLines">0</span>
          <span class="stat-lbl">line items</span>
        </div>
        <div class="stat">
          <span class="stat-val" id="statRecords">0</span>
          <span class="stat-lbl">total records</span>
        </div>
      </div>

      <!-- Tab: Source Data table -->
      <div class="tab-content" id="tabData">
        <div class="no-data" id="noDataMsg">
          <div class="icon"><i class="fa-solid fa-table-cells-large"></i></div>
          <p>Upload an Excel file to see your data here</p>
        </div>
        <div id="tableWrapper" style="display:none"></div>
      </div>

      <!-- Tab: EDI preview output -->
      <div class="tab-content" id="tabPreview" style="display:none">
        <div class="no-data" id="noPreviewMsg">
          <div class="icon"><i class="fa-solid fa-bolt"></i></div>
          <p>Generate an EDI file to see the preview here</p>
        </div>
        <div id="previewOutput" style="display:none"></div>
      </div>

    </div><!-- /.content-area -->

  </main>

  <!-- Application logic -->
  <script src="script.js"></script>

</body>
</html>